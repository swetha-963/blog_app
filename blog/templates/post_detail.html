<!DOCTYPE html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ post.title }} - Blogify</title>
  <link rel="stylesheet" href="{% static 'css/post_detail.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>

  <nav class="navbar">
    <a href="{% url 'home' %}" class="logo">Blogify</a>
    <a href="{% url 'crtblog' %}" class="btn">Create Blog</a>
  </nav>

  <div class="post-box">
    <div class="post-header">
      <a href="{% url 'profile' post.author.username %}">
        {% if post.author.profile.image %}
          <img src="{{ post.author.profile.image.url }}" alt="{{ post.author.username }}" class="profile-pic">
        {% else %}
          <img src="{% static 'images/default.jpg' %}" alt="Default" class="profile-pic">
        {% endif %}
      </a>

      <div class="author-info">
        <h3>{{ post.author.username }}</h3>
        <small>{{ post.created_at|date:"M d, Y" }}</small>
      </div>
    </div>

    <h2 class="post-title">{{ post.title }}</h2>

    {% if post.image %}
      <img src="{{ post.image.url }}" alt="{{ post.title }}" class="post-image">
    {% endif %}

    <div class="post-caption">
      <p>{{ post.content }}</p>
    </div>

    {% if request.user == post.author %}
    <div class="post-actions">
      <a href="{% url 'edit_post' post.id %}" class="edit-btn">Edit</a>
      <a href="{% url 'delete_post' post.id %}" class="delete-btn" onclick="return confirm('Are you sure you want to delete this post?')">Delete</a>
    </div>
    {% endif %}
  </div>

  <!-- Comments Section -->
  <section class="comments-section">
    <h3>Comments</h3>

    {% for comment in post.comments.all %}
      <div class="comment">
        <div class="comment-header">
          <strong>{{ comment.user.username }}</strong>
          <span class="comment-date">{{ comment.created_at|date:"M d, Y H:i" }}</span>
        </div>
        <p>{{ comment.content }}</p>

        {% if request.user == comment.user or request.user == post.author %}
        <a href="{% url 'delete_comment' comment.id %}" class="delete-comment" onclick="return confirm('Delete this comment?')">Delete</a>
        {% endif %}
      </div>
    {% empty %}
      <p class="no-comments">No comments yet.</p>
    {% endfor %}

    {% if user.is_authenticated %}
      <form action="{% url 'add_comment' post.id %}" method="POST" class="comment-form">
        {% csrf_token %}
        <textarea name="content" rows="2" placeholder="Add a comment..." required></textarea>
        <button type="submit">Post</button>
      </form>
    {% else %}
      <p class="signin-prompt"><a href="{% url 'loginusr' %}">Sign in</a> to comment.</p>
    {% endif %}
  </section>

</body>
</html>
